    IF  EXISTS
    (
        SELECT *
        FROM sys.procedures
        WHERE name ='$procedureName'
    )
    DROP PROCEDURE $procedureName

    DECLARE @procedureQuery nvarchar(MAX);
    DECLARE @initialProcedureQueryLength int;

    SET @procedureQuery =
    (
        'CREATE PROCEDURE $procedureName
        AS '
    )

    SET @initialProcedureQueryLength = LEN(@procedureQuery)

    #set($tableNames = "'" + $entityClass.getSimpleName().toUpperCase() + "', '" + $fieldClass.getSimpleName().toUpperCase() + "'")

    #foreach($entity in $entities)
        #set($tableNames = $tableNames + ", '" + $entity.getTableName() + "'")
    #end

    DECLARE @tablesToDelete nvarchar(MAX);

    SELECT @tablesToDelete = COALESCE(@tablesToDelete + ', ','') + SCHEMAS.name, @tablesToDelete = COALESCE(@tablesToDelete + '.','') + TABLES.name
    FROM
        sys.tables TABLES
            JOIN
        sys.schemas SCHEMAS
    ON
    TABLES.schema_id = SCHEMAS.schema_id
    WHERE TABLES.name NOT IN ($tableNames)

    IF LEN(@tablesToDelete) > 0
        SET @procedureQuery = @procedureQuery +
        (
            'DROP TABLE ' + @tablesToDelete + ' '
        )

    #foreach($entity in $entities)
        #set($fields = $entity.getFields())

        #if($fields.size() != 0)

            #set($tableName = $entity.getTableName())

            IF ('$tableName')
            NOT IN
            (
                SELECT name
                FROM sys.tables
            )
                SET @procedureQuery = @procedureQuery +
                (
                    'CREATE TABLE $schema.$tableName
                    (
                        #foreach($field in $fields)
                            #if($foreach.index != $field.size() - 1)
                                #if($field.getIsPrimaryKey())
                                    $field.getColumnName() $field.getType().concat(' PRIMARY KEY,')
                                #else
                                    $field.getColumnName() $field.getType().concat(',')
                                #end
                            #else
                                #if($field.getIsPrimaryKey())
                                    $field.getColumnName() $field.getType().concat(' PRIMARY KEY')
                                 #else
                                     $field.getColumnName() $field.getType()
                                 #end
                            #end
                        #end
                    ) '
                )
        #end
    #end

    EXEC sp_executesql @procedureQuery

    IF LEN(@procedureQuery) > @initialProcedureQueryLength
        EXEC ('$procedureName')
